# 端口监控
## 监控项说明

端口监控的目的是监控本机（127.0.0.1）端口的状态、响应时间以及返回内容。端口的状态指端口是否存活。响应时间是指发起检测请求后，需要等待的时间。返回内容是指返回正常以及其他异常情况的具体内容。

http等语义探测为本机模拟发起http请求。

| 监控项名称         | 监控项含义     | 单位 | 说明                                                         |
| ------------------ | -------------- | ---- | ------------------------------------------------------------ |
| ${name}.status    | 端口的状态     |      | 1表示正常，0表示异常                                         |
| ${name}.reason    | 端口的错误状态 |      | 0表示正常，1表示连接超时，2表示连接拒绝，3表示连接错误，4表示请求内容返回不匹配，5表示http状态码不匹配，6表示发送请求失败，7表示读取对方响应失败 |
| ${name}.res_time  | 响应时间       | 毫秒 |                                                              |
| ${name}.http_code | http状态码     |      | http的状态码，只有完成http协议通信的时候，这个监控项才有,未完成http协议通信时，无法获取响应时间及状态码 |



## 操作指南

步骤一：菜单选择【智能监控】-【监控配置】，左侧服务树选择产品线或产品线以下节点，在下图所示的采集配置列表页，点击“新建”。

![image](https://github.com/jdcloudcom/cn/blob/DevOps/image/DevOps/Operation-Guide30.JPG)
步骤二：打开如图所示的采集配置新建窗口。其中，

**监控类型**：选择端口监控

**方法**：端口探测的方法，包括端口探活、HTTP语义探测、TCP语义探测、UDP语义探测

**名称**：该条采集任务的名称，将作为监控指标的前缀支持字母、数字以及\_，且必须以字母开头

**范围**：端口监控采集配置的范围，与服务树所选节点相关联，原则是向下可选。当服务树选中应用节点时，范围只能选“应用”，服务树选中系统节点时，范围可选“系统”或“应用”，服务树选中产品线节点时，范围可选“产品线”、“系统”、“应用”

**节点**：采集配置的具体节点，选择系统或产品线节点时，将覆盖所属的所有应用。

**采集周期**：选择欲配置的采集周期。

**地址**：端口探测地址，本机IP/127.0.0.1 +端口号

HTTP等语义探测，还需填写请求地址，请求头等内容。    

```
PS：
配置动态IP：默认访问本机/127.0.0.1端口，如果无法使用此IP，可以切换至JSON配置方式，在端口号中填入$IP$。
配置动态端口：$MAIN_PORT$（配置此动态端口时，约定获取服务树上实例开启的主端口）
配置动态地址$DEPLOY_PATH$（服务树上实例部署路径）
```

![image](https://github.com/jdcloudcom/cn/blob/DevOps/image/DevOps/Operation-Guide31.JPG)

    HTTP等语义探测方法：由本机模拟发起http等请求进行探测，检查端口状态以及返回的内容是否正确。
    请求方式：支持GET/POST/HEAD
    请求头：支持添加多个字段值对
    匹配状态码：匹配的http状态码
    匹配内容：填写目标页面所包含的内容。

![image](https://github.com/jdcloudcom/cn/blob/DevOps/image/DevOps/Operation-Guide32.JPG)
