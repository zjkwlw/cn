# 服务树

服务树是DevOps的基础模块，在DevOps中扮演着CMDB的角色。用户可根据组织的业务架构，轻松地进行服务树节点的创建与管理，为DevOps其他模块提供各种运维场景的配置数据服务。

**术语定义**

服务树

服务树是一个可视化拓扑的树型结构，存储着业务组织架构信息。一方面，它以JNS服务（名字服务）为支持，按照“部门-产品线-系统-应用-分组-实例”的层级关系维护主机和实例的对应关系，为其他系统提供统一准确的服务数据信息；另一方面，用户可基于服务树实现角色管理和基于角色的统一权限控制，是DevOps系统的基础。

- 部门：用户可灵活定义并划分部门，如可以是实际组织中的一个二级或三级部门。
- 产品线：产品线是一个完整的产品或服务，如一个部门下可能有多个产品线或业务。
- 系统：系统是一个包含多个应用的集合，可以是一个独立的产品或产品的一个主要分支。
- 应用：应用可以是一个大的功能模块，也可以是一个小的功能点，用户可按实际业务情况进行定义与创建。
- 分组：一个应用可以创建多个不同生产环境或不同用途的分组，分别对每个分组添加机器，进行管理与部署。


**编辑服务树**

点击服务树菜单，在左侧对应节点，依次添加体系、部门、产品线、系统、应用，对于不同层级的节点，可进行基本设置、角色设置、主机列表。应用层级的节点，还可进行编辑分组、编辑实例

![Alt text](https://github.com/jdcloudcom/cn/blob/DevOps/image/DevOps/Operation4.png)

左侧指定应用节点，下面分别说明下五个分页的具体功能

1.基本设置

英文名、中文名、描述等

2.角色设置

编辑对应层级的不同权限角色（这里添加的用户名为此租户下已有用户名，详见账户管理）。

下级节点将继承上级节点的角色设置，比如，将user1设置为系统A的负责人，那么，user1将自动成为系统A下的所有应用的负责人。

3.主机列表

列出此节点下主机列表

4.编辑分组

可进行分组的设置，分组是在进行线上发布时选择的对象。

![Alt text](https://github.com/jdcloudcom/cn/blob/DevOps/image/DevOps/Operation5.png)

点击“新建分组”需填写基本英文名、中文名、环境（生产/预发）等。其中，按照分组是否“支持伸缩策略”分为两类：

1）支持伸缩策略
若选择支持伸缩策略，那么，在进行初次上线发布时，将按照所填写的实例模板、弹性主机数，在京东云控制台中，自动创建对应规格、数量的云主机。

![Alt text](https://github.com/jdcloudcom/cn/blob/DevOps/image/DevOps/Operation6.png)

- 实例模板：选择在菜单栏->配置管理->规格模板 中，定义好的规格模板
- 高可用组：否/是
- 地域：资源所在物理位置
- 可用区：若选择高可用组为是，那么，这里可多选可用区
- 计费方式：包年包月/按配置
- 弹性主机数：分组中的云主机数
- Tags：
- 描述：

后续部署完成后，将依照已设置好的伸缩策略和迁移策略进行伸缩与迁移。具体见规格模板页。

2）不支持伸缩策略

接下来根据选择部署主机的不同，分为以下两个类别

a.选择已有主机

![Alt text](https://github.com/jdcloudcom/cn/blob/DevOps/image/DevOps/Operation7.png)

点击确定后，进入到编辑实例页面，具体见编辑实例

b.根据实例模板创建主机

![Alt text](https://github.com/jdcloudcom/cn/blob/DevOps/image/DevOps/Operation8.png)

- 实例模板：选择在菜单栏-配置管理-规格模板 中，定义好的规格模板
- 高可用组：否/是
- 可用区：若选择高可用组为是，那么，这里可多选可用区
- 地域：资源所在物理位置
- 计费方式：包年包月/按配置
- 实例数：分组中的云主机数
- Tags：
- 描述：


5.编辑实例

1）支持伸缩策略  

对于在新建分组时，选择支持伸缩策略的分组，将根据所选择的实例模板在京东云控制台中自动创建云主机，因此，不涉及 编辑实例

2）不支持伸缩策略

a.选择已有主机

对于在新建分组时，选择不支持伸缩策且部署主机选择已有主机的分组，需要为分组添加实例。实例为已关联到对应服务树产品线的主机。“操作指南-资源池”将说明如何将京东云主机与服务树产品线相关联。

![Alt text](https://github.com/jdcloudcom/cn/blob/DevOps/image/DevOps/Operation9.png)

点击新增实例，在弹出的窗口选择分组，并为分组添加主机。这里所列出的主机列表，为已关联到此产品线的主机，详见 资源池

b.根据实例模板创建主机

对于在新建分组时，选择不支持伸缩策且部署主机选择根据实例模板创建主机，将根据所选择的实例模板在京东云控制台中自动创建云主机，在 编辑实例 分页中，可修改实例数。

![Alt text](https://github.com/jdcloudcom/cn/blob/DevOps/image/DevOps/Operation10.png)
