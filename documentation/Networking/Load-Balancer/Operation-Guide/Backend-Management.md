# 后端服务管理

## 添加后端服务

1. 通过应用负载均衡-详情-后端服务进入后端服务管理页；

3. 点击 **新建后端服务**，打开后端服务创建页；

5. 后端服务设置：
	
	**基本信息：**
	
	- 名称：定义后端服务名称；
	
	- 后端协议：可选http、tcp；

		注意：监听器只能与对应协议类型的后端服务绑定，后端协议为http时，只能绑定监听协议为http、https类型的监听器，后端协议为tcp时，只能绑定监听协议为tcp、tls类型的监听器；

	- 端口：输入范围1-65535，不同后端服务的端口可以重复；

	- 调度算法：支持加权轮询、加权最小连接数和源IP；

	- 会话保持：仅后端协议为http时支持配置，支持基于cookie植入方式的会话保持；

	- cookie超时时间：输入范围0-86400；

	- 获取真实IP：后端协议为http时，默认开启不可关闭，此时可通过X-Forwarded-For头字段获取客户端真实IP；后端协议为tcp时，支持proxy protocol协议方式透传客户端IP；
	
		注：当后端协议为tcp时，如开启获取真实IP，需在后端服务端完成proxy protocol的相关配置。

	- 获取HTTP头字段：支持X-Forwarded-Proto、X-Forwarded-Port、 X-Forwarded-LBIP 、X-Forwarded-Host多项，用于透传客户端http请求的相关信息；

		![ALB后端服务设置](../../../../image/Networking/ALB/ALB-028.png)

	**健康检查设置：**

	- 选择健康检查方式：HTTP、TCP；

	- 设置检查端口：输入范围1-65535，如不填写默认为后端实例接收负载均衡流量的端口；

	- 响应超时时间(s)：输入范围2-60秒,此为健康检查响应的最大超时时间；

	- 健康检查间隔(s):输入范围为5-300秒,此为健康检查的时间间隔；

	- 不健康阈值：输入范围1-5，此为后端实例从成功到失败的连续健康检查失败次数；

	- 健康阈值：输入范围1-5，此为后端实例从失败到成功的连续健康检查成功次数；

	- 正常态码：输入范围2xx（等价于200-299）、3xx（等价于300-399）、4xx（等价于400-499）；

	- 检查路径：仅健康检查方式为HTTP时填写，必须以“/”开头、最多支持5级目录，不得超过100字符。

		![ALB健康检查设置](../../../../image/Networking/ALB/ALB-029.png)	

	**添加服务器组：**

	- 选择服务器组类型：虚拟服务器、高可用组，或者可以暂不添加；

	- 虚拟服务器组：系统会自动筛选出当前可以绑定的服务器组列表，如没有可用的服务器组，可点击 **新建虚拟服务器组** 进行创建；

		注：可选服务器组中的后端实例必须与应用负载均衡处于相同地域、私有网络、可用区下。

	- 高可用组：系统会自动筛选出当前可以绑定的高可用组，如没有可用的高可用组，请前往高可用组页面进行创建；

		注：可选高可用组中的后端实例必须与应用负载均衡处于相同地域、私有网络、可用区下。

		![ALB添加服务器组](../../../../image/Networking/ALB/ALB-030.png)


## 管理后端服务

1. 查看后端服务详情：点击后端服务名称进入后端服务详情页，可查看后端服务配置信息、更换绑定的后端服务器组（见下文）；

1. 查看绑定的服务器组：列表页点击后端服务名称，查看后端服务关联的服务器组信息和健康状态；

1. 编辑后端服务：编辑后端服务器组相关配置信息（见下文）；

1. 删除后端服务：删除成功后后端服务将与绑定的服务器组自动解除关联，已关联监听器的后端服务不可删除；

![ALB管理后端服务](../../../../image/Networking/ALB/ALB-031.png)
	
## 更换后端服务绑定的服务器组

1. 通过应用负载均衡-详情-后端服务-详情打开后端服务详情，点击 **更改**，更换绑定的服务器组；

1. 通过应用负载均衡-详情-后端服务-编辑打开后端服务编辑页，更换绑定的服务器组；

![ALB更换后端绑定的服务器组](../../../../image/Networking/ALB/ALB-032.png)
	
## 编辑后端服务

1. 通过应用负载均衡-详情-后端服务-编辑打开后端服务编辑页；

1. 编辑后端服务配置项，其中后端协议、端口不可编辑，其余项均可编辑证书：如监听器有绑定的证书，可修改；

![ALB编辑后端服务](../../../../image/Networking/ALB/ALB-033.png)
	


